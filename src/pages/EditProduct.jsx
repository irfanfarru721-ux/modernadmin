import React,{useEffect,useState} from 'react'; import API from '../services/api'; import {useNavigate,useParams} from 'react-router-dom'; export default function EditProduct(){ const {id}=useParams(); const nav=useNavigate(); const [form,setForm]=useState(null); const [img,setImg]=useState(null); const [vendors,setV]=useState([]); const [cats,setC]=useState([]); useEffect(()=>{ API.get('/products/'+id).then(r=>setForm(r.data)).catch(console.error); API.get('/vendors').then(r=>setV(r.data)).catch(()=>{}); API.get('/categories').then(r=>setC(r.data)).catch(()=>{}); },[id]); const submit=async(e)=>{ e.preventDefault(); const fd=new FormData(); if(form.name) fd.append('name',form.name); if(form.price) fd.append('price',form.price); if(form.vendor) fd.append('vendor',form.vendor); if(form.category) fd.append('category',form.category); if(form.description) fd.append('description',form.description); if(img) fd.append('image',img); await API.put('/admin/products/'+id,fd,{headers:{'Content-Type':'multipart/form-data'}}).catch(console.error); nav('/products'); }; if(!form) return <p>Loading...</p>; return (<div><h1>Edit Product</h1><form className='card' onSubmit={submit}><input value={form.name||''} onChange={e=>setForm({...form,name:e.target.value})} required/><input type='number' value={form.price||''} onChange={e=>setForm({...form,price:e.target.value})} required/><select value={form.vendor||''} onChange={e=>setForm({...form,vendor:e.target.value})}>{vendors.map(v=>(<option key={v._id} value={v._id}>{v.name}</option>))}</select><select value={form.category||''} onChange={e=>setForm({...form,category:e.target.value})}>{cats.map(c=>(<option key={c._id} value={c._id}>{c.name}</option>))}</select><textarea value={form.description||''} onChange={e=>setForm({...form,description:e.target.value})}></textarea><input type='file' accept='image/*' onChange={e=>setImg(e.target.files[0])}/><button className='btn' type='submit'>Save</button></form></div>); }
